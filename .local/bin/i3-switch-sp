#!/bin/bash

# i3-switch-sp $1 $2
# $1: workspace
# $2: startup command

# Target workspace not found: to target workspace and exec startup command
# Target workspace focused: switch to prev workspace
# Target workspace not focused: let target workspace show on current monitor

# Example:
# $ i3-switch-sp 10 "$TERMINAL --title vimwiki -e nvim $HOME/vimwiki/index.md

declare -A target
target[workspace]=$1
target[output]=$(i3-msg -t get_workspaces | sed 's/{/\n{/g' |\
    grep -e "\"num\":$1" -A 1 | sed 's/,/\n/g' |\
    grep '"output"' | awk -F\" '{print $4}')

declare -A current
current[workspace]=$(i3-msg -t get_workspaces | sed 's/{/\n{/g' |\
    grep '"focused":true' -A 1 | sed 's/,/\n/g' |\
    grep '"num"' | sed 's/"num"://g')
current[output]=$(i3-msg -t get_workspaces | sed 's/{/\n{/g' |\
    grep '"focused":true' -A 1 | sed 's/,/\n/g' |\
    grep '"output"' | awk -F\" '{print $4}')


if [ -z ${target[output]} ]; then
    i3-msg workspace ${target[workspace]}
    $2 &
else

    if [ ${current[workspace]} == ${target[workspace]} ]; then
        i3-msg workspace back_and_forth
    else
        if [ ${current[output]} == ${target[output]} ];
        then
            i3-msg workspace ${target[workspace]}
        else
            i3-msg workspace ${target[workspace]}
            i3-msg move workspace to output ${current[output]}
            i3-msg workspace ${current[workspace]}
            i3-msg workspace ${target[workspace]}
        fi
    fi

fi
