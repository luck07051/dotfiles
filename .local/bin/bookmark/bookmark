#!/bin/sh

# pick url in bookmark file, and print to stdout

bookmark_file="${1:-$HOME/bm/bookmark}"
searchengine_file="${2:-$HOME/bm/searchengine}"

# delete the line start in '#' or empty line
selected="$(sed "/^\s*#/d; /^\$/d" "$bookmark_file" |
	column -t -s "$(printf '\t')" |
	dmenu -i -l 20 -p 'OPEN')"
[ -z "$selected" ] && exit

if grep -qw "\(${selected##* }\)$" "$bookmark_file"; then
	echo "${selected##* }"
else
	engine="$(grep "^${selected%% *}\s" "$searchengine_file" | cut -f2)"

	if [ -n "$engine" ]; then
		echo "$engine" | sed "s/{}/${selected#* }/g; s/\s/+/g"
	else
		grep "^DEFAULT" "$searchengine_file" | cut -f2 |
			sed "s/{}/$selected/g; s/\s/+/g"
	fi
fi
