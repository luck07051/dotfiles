#!/bin/sh

pager='less -R'
editor="nvim -c startinsert"
lang='en+zh-TW+ja'
trans_opt='-show-original n -show-original-phonetics n -show-translation y -show-translation-phonetics n -show-prompt-message n -show-languages n -show-original-dictionary n -show-dictionary y -show-alternatives n'

# clipboard / selection / editor
if [ -n "$1" ];then
	source="$1"
	case "$(echo "$source" | tr '[:upper:]' '[:lower:]')" in
		editor|clip*|sele*) ;;
		*) echo 'Input method not support.' >&2; exit 1;
	esac
else
	source="$(printf 'Editor\nClipboard\nSelection\n' | fzf)"
	[ -z "$source" ] && exit
fi

temp=$(mktemp /tmp/trans.XXXXXXXXXXX)
case "$(echo "$source" | tr '[:upper:]' '[:lower:]')" in
	editor) $editor "$temp" ;;
	clip*)  clip -o > "$temp" ;;
	sele*)  clip -s > "$temp" ;;
esac

if ! grep -qv '^\s*$' "$temp"; then
	rm "$temp"
	printf 'The content is empty.'
	read -r _
	exit
fi

trans ":$lang" $trans_opt <"$temp" | $pager

rm "$temp"
