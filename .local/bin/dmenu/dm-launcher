#!/bin/sh

# Programs launcher.

dmenu="${DMENU:-dmenu -i}"
term="${TERMINAL:-st} -e sh -c"
cache='/tmp/launcher-cache'

_path(){
	echo "$PATH" | tr ':' '\n' | xargs ls | sed '/^\//d; /^$/d' | sort | uniq
}
_app(){
	ls "$XDG_DATA_HOME/applications" | sort
}

_path > "$cache"
_app >> "$cache"

selected="$($dmenu -p "RUN" < "$cache")"

rm "$cache"

[ -z "$selected" ] && exit

case "$selected" in
	# desktop applications
	*.desktop) gtk-launch "$selected" ;;

	# exec command in terminal if query end with ';'
	*\;) $term "${selected%\;}" ;;

	# exec selected
	*) $selected
esac
