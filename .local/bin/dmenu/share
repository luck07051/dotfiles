#!/bin/sh

# cmd='curl -F "file=@$file" "0x0.st"'
cmd='xbackbone_uploader_admin.sh $file'

# use `fd` if have
if [ -x "$(which fd)" ]; then
  findcmd="fd . $PWD -t f"
else
  findcmd="find $PWD -type f"
fi

if [ "$PWD" = "$HOME" ]; then
  file="$($findcmd | sed "s#^$HOME#~#" |
    dmenu -i -l 25 -p "Pick a File" | sed "s#^~#$HOME#")"
else
  pwd="$(echo "$PWD" | sed "s#^$HOME#~#")"
  file="$($findcmd | sed "s#^$PWD#.#" |
    dmenu -i -l 25 -p "Pick a File from $pwd" | sed "s#^\.#$PWD#")"
fi
[ -z "$file" ] && exit 0

url="$(eval "$cmd")"
echo "$url"

echo "$url" | xclip -selection clipboard
notify-send "Share" "Your file '${file##*/}' uploaded to '$url'"
