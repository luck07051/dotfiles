#!/bin/sh

run() {
	if [ -x "$(which "$1")" ] && ! pidof -q "$1"
	then
		"$@" &
	fi
}

# Remap caps lock to Ctrl
setxkbmap -option ctrl:nocaps

# Set screen to 144 rate
xrandr --output HDMI-0 --mode 1920x1080 --rate 144.00

# No screen saver
xset s off
xset -dpms

xrdb -load "$XDG_CONFIG_HOME"/X11/xresources
setwallpaper
doas wg-quick up uivpn

# Startup app
run $BROWSER
run dunst
run unclutter
run xcompmgr -n
run fcitx5 -d
run entr-list
run syncthing serve --no-browser
run otd

while true; do
	killall dwmblocks >/dev/null 2>&1
	dwmblocks &
	(sleep 2s; kill -55 "$(pidof dwmblocks)") &

	dwm
done
